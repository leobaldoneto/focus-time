<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Focus Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    .btn-primary {
      padding: 0.5rem 1rem;
      background-color: #3b82f6;
      color: white;
      border-radius: 0.375rem;
      border: none;
      cursor: pointer;
      transition: opacity 0.2s;
      min-width: 3rem;
      min-height: 2.5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-primary:hover {
      opacity: 0.9;
    }
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn-pause {
      padding: 0.5rem 1rem;
      background-color: #f59e0b;
      color: white;
      border-radius: 0.375rem;
      border: none;
      cursor: pointer;
      transition: opacity 0.2s;
      min-width: 3rem;
      min-height: 2.5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-pause:hover {
      opacity: 0.9;
    }
    .btn-secondary {
      padding: 0.5rem 1rem;
      background-color: #6b7280;
      color: white;
      border-radius: 0.375rem;
      border: none;
      cursor: pointer;
      transition: opacity 0.2s;
      min-width: 3rem;
      min-height: 2.5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-secondary:hover {
      opacity: 0.9;
    }
    .btn-danger {
      padding: 0.5rem 1rem;
      background-color: #ef4444;
      color: white;
      border-radius: 0.375rem;
      border: none;
      cursor: pointer;
      transition: opacity 0.2s;
      min-width: 3rem;
      min-height: 2.5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-danger:hover {
      opacity: 0.9;
    }
    .input-base {
      width: 100%;
      border: 1px solid #4b5563;
      border-radius: 0.375rem;
      padding: 0.25rem 0.5rem;
      background-color: #374151;
      color: #d1d5db;
    }
    .modal-base {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 50;
    }
    .modal-content {
      background-color: #1f2937;
      border-radius: 0.5rem;
      padding: 1.5rem;
      width: 20rem;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body class="bg-gray-900 text-gray-300" x-data="focusApp()" @load="init()">
  <div class="container mx-auto px-4">
    <div class="bg-gray-800 p-4 flex justify-between items-center shadow">
      <div class="text-xl font-bold">Focus Time</div>
      <div class="flex space-x-4">
        <button @click="showSettings = true" class="btn-secondary" aria-label="Settings">
          <i class="fas fa-cog"></i>
        </button>
      </div>
    </div>

    <div class="text-center mt-4" id="app">
      <div class="relative mb-4 w-72 h-72 mx-auto">
        <div x-ref="timerRing" class="absolute inset-0 rounded-full border-8 border-blue-500"></div>
        <div class="absolute inset-0 flex flex-col items-center justify-center">
          <div x-text="statusText" class="text-2xl font-semibold"></div>
          <div role="timer" aria-live="polite" x-text="displayTime" class="text-6xl font-bold"></div>
        </div>
      </div>
    </div>

    <div class="flex flex-wrap justify-center space-x-4 mb-4" style="min-height: 2.5rem;">
      <button @click="startTimer()" x-show="!isRunning" class="btn-primary" aria-label="Play" style="visibility: hidden;" :style="!isRunning ? 'visibility: visible;' : ''">
        <i class="fas fa-play"></i>
      </button>
      <button @click="pauseTimer()" x-show="isRunning" class="btn-pause" aria-label="Pause" style="visibility: hidden;" :style="isRunning ? 'visibility: visible;' : ''">
        <i class="fas fa-pause"></i>
      </button>
      <button @click="stopTimer()" x-show="isRunning || isPaused" class="btn-danger" aria-label="Stop" style="visibility: hidden;" :style="isRunning || isPaused ? 'visibility: visible;' : ''">
        <i class="fas fa-stop"></i>
      </button>
      <button @click="toggleTimerVisibility()" class="btn-secondary" aria-label="Toggle Timer Visibility">
        <i :class="isTimerVisible ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
      </button>
    </div>

    <div class="mb-4 text-center">
      <span class="font-semibold">Break Time Credit:</span>
      <span x-text="formatTime(breakTimeCredit)"></span>
    </div>

    <div class="w-full max-w-md mx-auto mb-4">
      <div class="w-full bg-gray-700 h-4 rounded-full overflow-hidden">
        <div :style="`width: ${Math.min((totalFocusedTime / (settings.dailyGoal * 60)) * 100, 100)}%`" class="bg-blue-500 h-full"></div>
      </div>
      <div class="mt-1 text-sm text-center">
        <span x-text="`${Math.floor(totalFocusedTime / 60)} of ${settings.dailyGoal} minutes focused`"></span>
      </div>
    </div>

    <div class="text-center mb-4">
      Current Streak: <span x-text="streakCount"></span> days
    </div>

    <div class="mb-4 px-4">
      <label for="task-input" class="sr-only">Task Input</label>
      <input id="task-input" x-model="taskInput" type="text" placeholder="What are you working on?"
        class="mb-4 px-4 py-2 input-base w-full max-w-2xl mx-auto block"
        aria-label="Task Input">
      <div class="overflow-x-auto">
        <table class="table-fixed text-left mx-auto w-full max-w-2xl h-40 overflow-y-scroll border rounded p-2 bg-gray-800 border-gray-600">
          <thead>
            <tr>
              <th class="w-1/6 px-2 py-1 border-b border-gray-600">Type</th>
              <th class="w-2/6 px-2 py-1 border-b border-gray-600">Task</th>
              <th class="w-1/6 px-2 py-1 border-b border-gray-600">Start</th>
              <th class="w-1/6 px-2 py-1 border-b border-gray-600">Duration</th>
              <th class="w-1/6 px-2 py-1 border-b border-gray-600">Action</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="(item, idx) in historyLog" :key="idx">
              <tr>
                <td class="px-2 py-1 border-b border-gray-600" x-text="item.type"></td>
                <td class="px-2 py-1 border-b border-gray-600" x-text="item.task || '-'"></td>
                <td class="px-2 py-1 border-b border-gray-600" x-text="item.startTime"></td>
                <td class="px-2 py-1 border-b border-gray-600" x-text="item.duration"></td>
                <td class="px-2 py-1 border-b border-gray-600">
                  <button @click="deleteHistoryItem(idx)" class="text-red-500 hover:text-red-700">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div x-show="showSettings" class="modal-base" @click="showSettings = false" role="dialog" aria-modal="true">
    <div class="modal-content" @click.stop>
      <h2 class="text-xl font-bold mb-4">Settings</h2>
      <div class="mb-4">
        <label class="block text-left mb-2">Break Multiplier (e.g., 0.2):</label>
        <input x-model.number="settings.breakMultiplier" type="number" step="0.01" min="0" class="input-base">
      </div>
      <div class="mb-4">
        <label class="block text-left mb-2">Daily Focus Time Goal (minutes):</label>
        <input x-model.number="settings.dailyGoal" type="number" min="1" class="input-base">
      </div>
      <div class="mb-4 flex items-center">
        <input x-model="settings.enableWebhooks" type="checkbox" class="mr-2">
        <label>Enable Webhooks</label>
      </div>
      <div class="mb-4">
        <label class="block text-left mb-2">Webhook URL:</label>
        <input x-model="settings.webhookURL" type="url" class="input-base" placeholder="https://example.com/webhook">
      </div>
      <div class="mb-4 flex items-center">
        <input x-model="settings.enableAlarmSound" type="checkbox" class="mr-2">
        <label>Enable Alarm Sound</label>
      </div>
      <div class="mb-4">
        <button @click="confirmClearHistory()" class="btn-danger">Clear History</button>
      </div>
      <div class="mb-4">
        <button @click="confirmResetApp()" class="btn-danger">Reset App</button>
      </div>
      <div class="flex justify-end space-x-2">
        <button @click="showSettings = false" class="btn-secondary">Close</button>
        <button @click="saveSettings()" class="btn-primary">Save</button>
      </div>
    </div>
  </div>

  <div x-show="showConfirm" class="modal-base" @click="showConfirm = false" role="dialog" aria-modal="true">
    <div class="modal-content" @click.stop>
      <p x-text="confirmMessage" class="mb-4"></p>
      <div class="flex justify-end space-x-2">
        <button @click="showConfirm = false" class="btn-secondary">No</button>
        <button @click="executeConfirmCallback()" class="btn-primary">Yes</button>
      </div>
    </div>
  </div>

  <div x-show="notification" x-transition class="fixed bottom-5 right-5 bg-blue-500 text-white px-4 py-2 rounded shadow-lg">
    <span x-text="notificationMessage"></span>
  </div>

  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="app.js"></script>
</body>

</html>